---
id: T-302
type: task
status: todo
priority: high
parent_spec: 003-benchmark-cli.md
---

# Configuration Module

Create the configuration module that manages service URLs, timeouts, and other settings loaded from environment variables.

## Sub-tasks:

- [x] **Create config struct**: Define `Config` struct in `internal/config/config.go` with fields for `PlayerServiceURL`, `MatchmakerServiceURL`, `HTTPTimeout`, `ConnectionPoolSize`
- [x] **Implement Load function**: Create `Load() *Config` function that reads from environment variables with sensible defaults
- [x] **Set default values**: `PLAYER_SERVICE_URL` defaults to `http://localhost:5000`, `MATCHMAKER_SERVICE_URL` defaults to `http://localhost:8000`
- [x] **Add HTTP timeout config**: Default timeout of 10 seconds for HTTP requests
- [x] **Add connection pool config**: Configure HTTP transport settings for high-concurrency benchmarking
  - [x] Add `MaxIdleConns` field (default: 100) - total number of idle connections kept alive across all hosts. When this limit is reached, the least recently used idle connection is closed.
  - [x] Add `MaxIdleConnsPerHost` field (default: 100) - idle connections kept per host. Go's default is only 2, which causes connection churn under load. Set this equal to or higher than your expected concurrent requests per host.
  - [x] Add `MaxConnsPerHost` field (default: 0 = unlimited) - hard cap on total connections (active + idle) to a single host. Use this to prevent overwhelming a target service during benchmarks.
  - [x] Read from env vars: `HTTP_MAX_IDLE_CONNS`, `HTTP_MAX_IDLE_CONNS_PER_HOST`, `HTTP_MAX_CONNS_PER_HOST`
  - [x] Document in config that these values should be >= your `-concurrency` flag value for optimal performance
- [x] **Write unit tests**: Test that defaults are applied when env vars are missing, and env vars override defaults when present
