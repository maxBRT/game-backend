---
id: T-206
type: task
status: todo
priority: high
parent_spec: 002-matchmaker-service.md
---

# Status Endpoint Handler - GET /match/status/{ticketId}

Implement the long-polling HTTP handler for checking match status.

## Sub-tasks:

- [x] **Define StatusResponse structs** (`internal/handlers/status.go`):
  - WaitingResponse:
    ```go
    type WaitingResponse struct {
        Status        string `json:"status"`
        QueuePosition int    `json:"queuePosition"`
    }
    ```
  - MatchedResponse:
    ```go
    type MatchedResponse struct {
        Status    string       `json:"status"`
        MatchID   string       `json:"matchId"`
        Survivors []PlayerInfo `json:"survivors"`
        Killer    PlayerInfo   `json:"killer"`
    }
    ```

- [x] **Implement StatusHandler struct**:
  - Reference to QueueManager
  - `pollTimeout` (time.Duration): Max time to hold request (default: 30s)
  - `pollInterval` (time.Duration): How often to check for match (default: 500ms)
  - Constructor that accepts QueueManager

- [x] **Implement ServeHTTP or handler function**:
  - Extract ticketId from URL path parameter
  - Validate ticketId is not empty

- [x] **Implement long-polling loop**:
  - Set up timeout context based on pollTimeout
  - Loop with pollInterval ticker:
    - Check if match exists via QueueManager.GetMatchByTicket()
    - If matched: return MatchedResponse with match details
    - If waiting: continue polling
    - If timeout: return WaitingResponse with current position
  - Respect client disconnect (context cancellation)

- [x] **Implement response formatting**:
  - Convert Match model to MatchedResponse
  - Convert Player models to PlayerInfo for API response
  - Set appropriate Content-Type header (application/json)

- [x] **Implement error handling**:
  - Return 400 Bad Request if ticketId missing
  - Return 404 Not Found if ticketId not in any queue or match
  - Handle context cancellation gracefully
